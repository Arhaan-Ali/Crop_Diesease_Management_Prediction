import torch
from torchvision import models, transforms
from  PIL import Image
import torch.nn as nn

Model_path = "rice_disease_model.pt"
Image_path = "img.png"
Class_name = ['Bacterialblight' , 'Blast' , 'Brownspot' , 'Tungro']

device = torch.device("cuda" if torch.cuda.is_available() else "cpu")

model = models.mobilenet_v3_large(weights = None)
num_ftrs = model.classifier[-1].in_features
model.classifier[-1] = nn.Linear(num_ftrs , len(Class_name))

model.load_state_dict(torch.load(Model_path, map_location= device ))
model = model.to(device)
model.eval()

transform = transforms.Compose([
    transforms.ToTensor(),
    transforms.Normalize((0.5, 0.5, 0.5),
                         (0.5, 0.5, 0.5))
])

image = Image.open(Image_path).convert("RGB")
image = transform(image)
image = image.unsqueeze(0).to(device)

with torch.no_grad():
    outputs = model(image)
    probabilities = torch.softmax(outputs, dim=1)
    confidence, predicted_idx = torch.max(probabilities, 1)

predicted_class = Class_name[predicted_idx.item()]
confidence = confidence.item() * 100

print(f"Prediction: {predicted_class}")
print(f"Confidence: {confidence:.2f}%")





































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































